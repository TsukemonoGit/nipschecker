name: Fetch Open Pull Requests

on:
  schedule:
    - cron: "0 0 * * *" # 毎日UTC 00:00（日本時間 09:00）に実行
  workflow_dispatch: # 手動実行も可能

jobs:
  fetch-prs:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # リポジトリのコンテンツに対する書き込み権限を与える
    steps:
      - name: リポジトリをチェックアウト
        uses: actions/checkout@v4

      - name: GitHub API からオープンな PR を取得
        run: |
          curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          "https://api.github.com/repos/nostr-protocol/nips/pulls?state=open" | jq '.' > pull_requests.json

      - name: 変更があればコミットしてプッシュ
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions@github.com"
          git checkout main # main ブランチに切り替え

          # pull_requests.json ファイルに変更があれば commit を実行
          git add pull_requests.json
          if ! git diff --quiet; then
            git commit -m "Update open pull requests list"
            git push origin main --force # main ブランチにプッシュ
          else
            echo "No changes detected, skipping commit."
          fi
